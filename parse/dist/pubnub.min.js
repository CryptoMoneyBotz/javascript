!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define(["crypto","buffer"],b):"object"==typeof exports?exports.PUBNUB=b(require("crypto"),require("buffer")):a.PUBNUB=b(a.crypto,a.buffer)}(this,function(a,b){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a,b){return h.createHmac("sha256",new i(b,"utf8")).update(a).digest("base64")}function e(a){console.error(a)}function f(a){function b(a,b){g({message:a,payload:b})}var c,d,e,f=a.success||function(){},g=a.fail||function(){},h=a.mode||"GET",i=a.data||{},k={};"POST"===h&&(c=decodeURIComponent(a.url.pop())),e=j.build_url(a.url,i),e="/"+e.split("/").slice(3).join("/"),d=a.url[0].split("//")[1],k.url="http://"+d+e,k.method=h,k.body=c,Parse.Cloud.httpRequest(k).then(function(a){var c;try{c=JSON.parse(a.text)}catch(d){return void b("Bad JSON response",a.text)}f(c)},function(a){var c;try{c=JSON.parse(a.text),"object"==typeof c&&"error"in c&&c.error===!0?g(c):b("Network error",a.text)}catch(d){b("Network error",a.text)}})}function g(){function a(a){return h.createHash("sha256").update(a).digest("hex").slice(0,32)}var b="0123456789012345";return{encrypt:function(c,d){if(!d)return c;var e=JSON.stringify(c),f=h.createCipheriv("aes-256-cbc",a(d),b),g=f.update(e,"utf8","base64")+f["final"]("base64");return g||c},decrypt:function(c,d){var e;if(!d)return c;var f=h.createDecipheriv("aes-256-cbc",a(d),b);try{e=f.update(c,"base64","utf8")+f["final"]("utf8")}catch(g){return null}return JSON.parse(e)}}}var h=c(1),i=c(2).Buffer,j=c(3),k=function(){var a={};return{get:function(b){return a[b]},set:function(b,c){a[b]=c}}}(),l=function(a){a.xdr=f,a.db=k,a.error=a.error||e,a.hmac_SHA256=d,a.crypto_obj=g(),a.sdk_family="Parse";var b=function(a){return l(a)},c=j.PN_API(a);for(var h in c)c.hasOwnProperty(h)&&(b[h]=c[h]);return b.init=b,b.secure=b,b.subscribe=function(){throw Error("#subscribe() method is disabled in Parse.com environment")},b.ready(),b};l.init=l,l.unique=j.unique,l.secure=l,a.exports=l,a.exports.PNmessage=j.PNmessage},function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b,c){function d(){return"x"+ ++m+ +new Date}function e(a,b){var c=[];return l.each(a,function(a,d){b?a.search("-pnpres")<0&&d.subscribed&&c.push(a):d.subscribed&&c.push(a)}),c.sort()}function f(a,b){var c=[];return l.each(a,function(a,d){b?a.search("-pnpres")<0&&d.subscribed&&c.push(a):d.subscribed&&c.push(a)}),c.sort()}function g(){n||(n=1,l.each(o,function(a){a()}))}function h(a){var b=a||{apns:{}};return b.getPubnubMessage=function(){var a={};if(Object.keys(b.apns).length){a.pn_apns={aps:{alert:b.apns.alert,badge:b.apns.badge,sound:b.apns.sound}};for(var c in b.apns)a.pn_apns[c]=b.apns[c];var d=["badge","alert","sound"];for(var c in d)delete a.pn_apns[d[c]]}b.gcm&&(a.pn_gcm={data:b.gcm});for(var c in b)a[c]=b[c];var e=["apns","gcm","publish","channel","callback","error"];for(var c in e)delete a[e[c]];return a},b.publish=function(){var a=b.getPubnubMessage();b.pubnub&&b.channel&&b.pubnub.publish({message:a,channel:b.channel,callback:b.callback,error:b.error})},b}function i(a){function b(){var a="PubNub-JS-"+Ea;return Da&&(a+="-"+Da),a+="/"+x}function c(a){return a||(a={}),l.each(va,function(b,c){b in a||(a[b]=c)}),a.pnsdk=b(),a}function h(a){var b=[];return l.each(a,function(a,c){b.push(a)}),b}function i(a){return h(a).sort()}function j(a){var b="",c=i(a);for(var d in c){var e=c[d];b+=e+"="+l.pamEncode(a[e]),d!=c.length-1&&(b+="&")}return b}function k(a,b,c){var d=!1;if("undefined"==typeof a)return b;if("number"==typeof a)d=!(a>v||0==a);else{if("boolean"==typeof a)return a?w:0;d=!0}return d?(c&&c("Presence Heartbeat value invalid. Valid range ( x > "+v+" or x = 0). Current Value : "+(b||v)),b||v):a}function m(a,b){return Ja.encrypt(a,b||Aa)||a}function r(a,b){return Ja.decrypt(a,b||Aa)||Ja.decrypt(a,Aa)||a}function z(){return clearTimeout(oa),!qa||qa>=500||qa<1||!e(la,!0).length&&!f(ma,!0).length?void(ra=!1):(ra=!0,void Ka.presence_heartbeat({callback:function(a){oa=l.timeout(z,qa*u)},error:function(a){wa&&wa("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(a)),oa=l.timeout(z,qa*u)}}))}function A(){!ra&&z()}function B(a){if(sa){if(!ca.length)return}else{if(a&&(ca.sending=0),ca.sending||!ca.length)return;ca.sending=1}G(ca.shift())}function C(a){var b=0;return l.each(f(ma),function(c){var d=ma[c];d&&(b++,(a||function(){})(d))}),b}function D(a){var b=0;return l.each(e(la),function(c){var d=la[c];d&&(b++,(a||function(){})(d))}),b}function E(a,b,c){if("object"==typeof a){if(a.error){var d={};return a.message&&(d.message=a.message),a.payload&&(d.payload=a.payload),void(c&&c(d))}if(a.payload)return void(a.next_page?b&&b(a.payload,a.next_page):b&&b(a.payload))}b&&b(a)}function F(a,b){if("object"==typeof a&&a.error){var c={};return a.message&&(c.message=a.message),a.payload&&(c.payload=a.payload),void(b&&b(c))}b&&b(a)}function G(a){var b=a.operation,c=Math.floor((new Date).getTime()/1e3),d=a.data||{};if(X){d.auth||delete d.auth,d.timestamp=c;var e=V+"\n"+U+"\n";if("PNAccessManagerGrant"===b)e+="grant\n";else if("PNAccessManagerAudit"===b)e+="audit\n";else{var f=a.url.slice();f.shift(),e+="/"+f.join("/")+"\n"}e+=j(d);var g=Y(e,X);g=g.replace(/\+/g,"-"),g=g.replace(/\//g,"_"),d.signature=g,a.data=d}return ua(a)}function H(a,b,d,e){var b=a.callback||b,f=a.error||wa,g=ya();e=e||{},e.auth||(e.auth=a.auth_key||W);var h=[_,"v1","channel-registration","sub-key",V];h.push.apply(h,d),g&&(e.callback=g),G({callback:g,data:c(e),success:function(a){E(a,b,f)},fail:function(a){F(a,f)},url:h})}function I(){xa()||K(1,{error:"Offline. Please check your network settings."}),N&&clearTimeout(N),N=l.timeout(I,u)}function J(){S&&Ka.time(function(a){M(function(){},a),a||K(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),O&&clearTimeout(O),O=l.timeout(J,R)})}function K(a,b){ha&&ha(a,b),ha=null,clearTimeout(N),clearTimeout(O)}function L(a){var b=l.rnow()-ea;return b-a/1e4}function M(a,b){function c(b){if(b){var c=b/1e4,e=(l.rnow()-d)/2;ea=l.rnow()-(c+e),a&&a(ea)}}var d=l.rnow();b&&c(b)||Ka.time(c)}var N,O,P=+a.windowing||q,Q=(+a.timeout||s)*u,R=(+a.keepalive||t)*u,S=a.timecheck||0,T=a.noleave||0,U=a.publish_key,V=a.subscribe_key,W=a.auth_key||"",X=a.secret_key||"",Y=a.hmac_SHA256,Z=a.ssl?"s":"",$="http"+Z+"://"+(a.origin||"pubsub.pubnub.com"),_=y($),aa=y($),ba=function(){},ca=[],da=!0,ea=0,fa=0,ga=0,ha=0,ia=a.restore||0,ja=0,ka=!1,la={},ma={},na={},oa=null,pa=k(a.heartbeat||a.pnexpires||0,a.error),qa=a.heartbeat_interval||pa/2-1,ra=!1,sa=a.no_wait_for_pending,ta=a["compatible_3.5"]||!1,ua=a.xdr,va=a.params||{},wa=a.error||function(){},xa=a._is_online||function(){return 1},ya=a.jsonp_cb||function(){return 0},za=a.db||{get:function(){},set:function(){}},Aa=a.cipher_key,Ba=a.uuid||!a.unique_uuid&&za&&za.get(V+"uuid")||"",Ca=a.instance_id||!1,Da=a.partner_id,Ea=a.sdk_family,Fa="",Ga=a.shutdown,Ha="undefined"==typeof a.use_send_beacon||a.use_send_beacon,Ia=Ha?a.sendBeacon:null;2===pa&&(qa=1);var Ja=a.crypto_obj||{encrypt:function(a,b){return a},decrypt:function(a,b){return a}},Ka={LEAVE:function(a,b,d,e,f){var g,h,i={uuid:Ba,auth:d||W},j=y($),e=e||function(){},k=f||function(){},m=ya();if(a.indexOf(p)>0)return!0;if(ta){if(!Z)return!1;if("0"==m)return!1}if(T)return!1;if("0"!=m&&(i.callback=m),Ca&&(i.instanceid=Fa),g=[j,"v2","presence","sub_key",V,"channel",l.encode(a),"leave"],h=c(i),Ia){var n=l.buildURL(g,h);if(Ia(n))return e&&e({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return G({blocking:b||Z,callback:m,data:h,success:function(a){E(a,e,k)},fail:function(a){F(a,k)},url:g}),!0},LEAVE_GROUP:function(a,b,d,e,f){var g,h,i={uuid:Ba,auth:d||W},j=y($),e=e||function(){},k=f||function(){},m=ya();if(a.indexOf(p)>0)return!0;if(ta){if(!Z)return!1;if("0"==m)return!1}if(T)return!1;if("0"!=m&&(i.callback=m),a&&a.length>0&&(i["channel-group"]=a),Ca&&(i.instanceid=Fa),g=[j,"v2","presence","sub_key",V,"channel",l.encode(","),"leave"],h=c(i),Ia){var n=l.buildURL(g,h);if(Ia(n))return e&&e({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return G({blocking:b||Z,callback:m,data:h,success:function(a){E(a,e,k)},fail:function(a){F(a,k)},url:g}),!0},set_resumed:function(a){ka=a},get_cipher_key:function(){return Aa},set_cipher_key:function(a){Aa=a},raw_encrypt:function(a,b){return m(a,b)},raw_decrypt:function(a,b){return r(a,b)},get_heartbeat:function(){return pa},set_heartbeat:function(a,b){pa=k(a,pa,wa),qa=b||pa/2-1,2==pa&&(qa=1),ba(),z()},get_heartbeat_interval:function(){return qa},set_heartbeat_interval:function(a){qa=a,z()},get_version:function(){return x},getGcmMessageObject:function(a){return{data:a}},getApnsMessageObject:function(a){var b={aps:{badge:1,alert:""}};for(var c in a)c[b]=a[c];return b},_add_param:function(a,b){va[a]=b},channel_group:function(a,b){var c,d,e=a.channel_group,b=b||a.callback,f=a.channels||a.channel,g=a.cloak,h=[],i={},j=a.mode||"add";if(e){var k=e.split(":");k.length>1?(c="*"===k[0]?null:k[0],d=k[1]):d=k[0]}c&&h.push("namespace")&&h.push(l.encode(c)),h.push("channel-group"),d&&"*"!==d&&h.push(d),f?(l.isArray(f)&&(f=f.join(",")),i[j]=f,i.cloak=da?"true":"false"):"remove"===j&&h.push("remove"),"undefined"!=typeof g&&(i.cloak=g?"true":"false"),H(a,b,h,i)},channel_group_list_groups:function(a,b){var c;c=a.namespace||a.ns||a.channel_group||null,c&&(a.channel_group=c+":*"),Ka.channel_group(a,b)},channel_group_list_channels:function(a,b){return a.channel_group?void Ka.channel_group(a,b):wa("Missing Channel Group")},channel_group_remove_channel:function(a,b){return a.channel_group?a.channel||a.channels?(a.mode="remove",void Ka.channel_group(a,b)):wa("Missing Channel"):wa("Missing Channel Group")},channel_group_remove_group:function(a,b){return a.channel_group?a.channel?wa("Use channel_group_remove_channel if you want to remove a channel from a group."):(a.mode="remove",void Ka.channel_group(a,b)):wa("Missing Channel Group")},channel_group_add_channel:function(a,b){return a.channel_group?a.channel||a.channels?void Ka.channel_group(a,b):wa("Missing Channel"):wa("Missing Channel Group")},channel_group_cloak:function(a,b){return"undefined"==typeof a.cloak?void b(da):(da=a.cloak,void Ka.channel_group(a,b))},channel_group_list_namespaces:function(a,b){var c=["namespace"];H(a,b,c)},channel_group_remove_namespace:function(a,b){var c=["namespace",a.namespace,"remove"];H(a,b,c)},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,e=a.reverse||"false",f=a.error||function(){},g=a.auth_key||W,h=a.cipher_key,i=a.channel,j=a.channel_group,k=a.start,m=a.end,n=a.include_token,o=a.string_message_token||!1,p={},q=ya();return i||j?b?V?(p.stringtoken="true",p.count=d,p.reverse=e,p.auth=g,j&&(p["channel-group"]=j,i||(i=",")),q&&(p.callback=q),k&&(p.start=k),m&&(p.end=m),n&&(p.include_token="true"),o&&(p.string_message_token="true"),void G({callback:q,data:c(p),success:function(a){if("object"==typeof a&&a.error)return void f({message:a.message,payload:a.payload});for(var c=a[0],d=[],e=0;e<c.length;e++)if(n){var g=r(c[e].message,h),i=c[e].timetoken;try{d.push({message:JSON.parse(g),timetoken:i})}catch(j){d.push({message:g,timetoken:i})}}else{var g=r(c[e],h);try{d.push(JSON.parse(g))}catch(j){d.push(g)}}b([d,a[1],a[2]])},fail:function(a){F(a,f)},url:[_,"v2","history","sub-key",V,"channel",l.encode(i)]})):wa("Missing Subscribe Key"):wa("Missing Callback"):wa("Missing Channel")},replay:function(a,b){var d,b=b||a.callback||function(){},e=a.auth_key||W,f=a.source,g=a.destination,h=a.error||a.error||function(){},i=a.stop,j=a.start,k=a.end,l=a.reverse,m=a.limit,n=ya(),o={};return f?g?U?V?("0"!=n&&(o.callback=n),i&&(o.stop="all"),l&&(o.reverse="true"),j&&(o.start=j),k&&(o.end=k),m&&(o.count=m),o.auth=e,d=[_,"v1","replay",U,V,f,g],void G({callback:n,success:function(a){E(a,b,h)},fail:function(){b([0,"Disconnected"])},url:d,data:c(o)})):wa("Missing Subscribe Key"):wa("Missing Publish Key"):wa("Missing Destination Channel"):wa("Missing Source Channel")},auth:function(a){W=a,ba()},time:function(a){var b=ya(),d={uuid:Ba,auth:W};Ca&&(d.instanceid=Fa),G({callback:b,data:c(d),url:[_,"time",b],success:function(b){a(b[0])},fail:function(){a(0)}})},publish:function(a,b){var d=a.message;if(!d)return wa("Missing Message");var e,f,b=b||a.callback||d.callback||a.success||function(){},g=a.channel||d.channel,h=a.meta||a.metadata,i=a.auth_key||W,j=a.cipher_key,k=a.error||d.error||function(){},n=a.post||!1,o=!("store_in_history"in a)||a.store_in_history,p=!("replicate"in a)||a.replicate,q=ya(),r="push";return a.prepend&&(r="unshift"),g?U?V?(d.getPubnubMessage&&(d=d.getPubnubMessage()),d=JSON.stringify(m(d,j)),f=[_,"publish",U,V,0,l.encode(g),q,l.encode(d)],e={uuid:Ba,auth:i},h&&"object"==typeof h&&(e.meta=JSON.stringify(h)),o||(e.store="0"),p||(e.norep="true"),Ca&&(e.instanceid=Fa),ca[r]({callback:q,url:f,data:c(e),fail:function(a){F(a,k),B(1)},success:function(a){E(a,b,k),B(1)},mode:n?"POST":"GET"}),void B()):wa("Missing Subscribe Key"):wa("Missing Publish Key"):wa("Missing Channel")},fire:function(a,b){a.store_in_history=!1,a.replicate=!1,Ka.publish(a,b)},unsubscribe:function(a,b){var c=a.channel,d=a.channel_group,e=a.auth_key||W,b=b||a.callback||function(){},f=a.error||function(){};if(!c&&!d)return wa("Missing Channel or Channel Group");if(!V)return wa("Missing Subscribe Key");if(c){var g=l.isArray(c)?c:(""+c).split(","),h=[],i=[];if(l.each(g,function(a){la[a]&&h.push(a)}),0==h.length)return void b({action:"leave"});l.each(h,function(a){i.push(a+p)}),l.each(h.concat(i),function(a){a in la&&delete la[a],a in na&&delete na[a]}),0===la.length&&0===ma.length&&(ja=0);var j=!0;n&&(j=Ka.LEAVE(h.join(","),0,e,b,f)),j||b({action:"leave"})}if(d){var k=l.isArray(d)?d:(""+d).split(","),m=[],o=[];if(l.each(k,function(a){ma[a]&&m.push(a)}),0==m.length)return void b({action:"leave"});l.each(m,function(a){o.push(a+p)}),l.each(m.concat(o),function(a){a in ma&&delete ma[a],a in na&&delete na[a]}),0===la.length&&0===ma.length&&(ja=0);var j=!0;n&&(j=Ka.LEAVE_GROUP(m.join(","),0,e,b,f)),j||b({action:"leave"})}ba()},subscribe:function(a,b){function d(a){a?l.timeout(ba,B):(_=y($,1),aa=y($,1),l.timeout(function(){Ka.time(d)},u)),D(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):void(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)))}),C(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):void(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)))})}function g(){var a=ya(),b=e(la).join(","),h=f(ma).join(",");if(b||h){b||(b=","),K();var i=c({uuid:Ba,auth:W});h&&(i["channel-group"]=h);var j=JSON.stringify(na);j.length>2&&(i.state=JSON.stringify(na)),pa&&(i.heartbeat=pa),Ca&&(i.instanceid=Fa),A(),ha=G({timeout:z,callback:a,fail:function(a){a&&a.error&&a.service?(F(a,q),d(!1)):Ka.time(function(b){!b&&F(a,q),d(b)})},data:c(i),url:[aa,"subscribe",V,l.encode(b),a,ja],success:function(a){if(!a||"object"==typeof a&&"error"in a&&a.error)return q(a),l.timeout(ba,u);if(s(a[1]),ja=!ja&&ia&&za.get(V)||a[1],D(function(a){a.connected||(a.connected=1,a.connect(a.name))}),C(function(a){a.connected||(a.connected=1,a.connect(a.name))}),ka&&!ia)return ja=0,ka=!1,za.set(V,0),void l.timeout(g,B);w&&(ja=1e4,w=0),za.set(V,a[1]);var b=function(){var b="",c="";a.length>3?(b=a[3],c=a[2]):b=a.length>2?a[2]:l.map(e(la),function(b){return l.map(Array(a[0].length).join(",").split(","),function(){return b})}).join(",");var d=b.split(","),f=c?c.split(","):[];return function(){var a=d.shift()||ga,b=f.shift(),c={},e={callback:function(){}};b?(a&&a.indexOf("-pnpres")>=0&&b.indexOf("-pnpres")<0&&(b+="-pnpres"),c=ma[b]||la[b]||e):c=la[a]||e;var g=[c.callback||fa,a.split(p)[0]];return b&&g.push(b.split(p)[0]),g}}(),c=L(+a[1]);l.each(a[0],function(d){var e=b(),f=r(d,la[e[1]]?la[e[1]].cipher_key:null);e[0]&&e[0](f,a,e[2]||e[1],c,e[1])}),l.timeout(g,B)}})}}var h=a.channel,i=a.channel_group,b=b||a.callback,b=b||a.message,j=a.connect||function(){},k=a.reconnect||function(){},m=a.disconnect||function(){},q=a.error||q||function(){},s=a.idle||function(){},t=a.presence||0,v=a.noheresync||0,w=a.backfill||0,x=a.timetoken||0,z=a.timeout||Q,B=a.windowing||P,E=a.state,H=a.heartbeat||a.pnexpires,I=a.heartbeat_interval,J=a.restore||ia;return W=a.auth_key||W,ia=J,ja=x,h||i?b?V?((H||0===H||I||0===I)&&Ka.set_heartbeat(H,I),h&&l.each((h.join?h.join(","):""+h).split(","),function(d){var e=la[d]||{};la[ga=d]={name:d,connected:e.connected,disconnected:e.disconnected,subscribed:1,callback:fa=b,cipher_key:a.cipher_key,connect:j,disconnect:m,reconnect:k},E&&(d in E?na[d]=E[d]:na[d]=E),t&&(Ka.subscribe({channel:d+p,callback:t,restore:J}),e.subscribed||v||Ka.here_now({channel:d,data:c({uuid:Ba,auth:W}),callback:function(a){l.each("uuids"in a?a.uuids:[],function(b){t({action:"join",uuid:b,timestamp:Math.floor(l.rnow()/1e3),occupancy:a.occupancy||1},a,d)})}}))}),i&&l.each((i.join?i.join(","):""+i).split(","),function(d){var e=ma[d]||{};ma[d]={name:d,connected:e.connected,disconnected:e.disconnected,subscribed:1,callback:fa=b,cipher_key:a.cipher_key,connect:j,disconnect:m,reconnect:k},t&&(Ka.subscribe({channel_group:d+p,callback:t,restore:J,auth_key:W}),e.subscribed||v||Ka.here_now({channel_group:d,data:c({uuid:Ba,auth:W}),callback:function(a){l.each("uuids"in a?a.uuids:[],function(b){t({action:"join",uuid:b,timestamp:Math.floor(l.rnow()/1e3),occupancy:a.occupancy||1},a,d)})}}))}),ba=function(){K(),l.timeout(g,B)},n?void ba():o.push(ba)):wa("Missing Subscribe Key"):wa("Missing Callback"):wa("Missing Channel")},here_now:function(a,b){var b=a.callback||b,d=a.debug,e=a.error||function(){},f=a.auth_key||W,g=a.channel,h=a.channel_group,i=ya(),j=!("uuids"in a)||a.uuids,k=a.state,m={uuid:Ba,auth:f};if(j||(m.disable_uuids=1),k&&(m.state=1),!b)return wa("Missing Callback");if(!V)return wa("Missing Subscribe Key");var n=[_,"v2","presence","sub_key",V];g&&n.push("channel")&&n.push(l.encode(g)),"0"!=i&&(m.callback=i),h&&(m["channel-group"]=h,!g&&n.push("channel")&&n.push(",")),Ca&&(m.instanceid=Fa),G({callback:i,data:c(m),success:function(a){E(a,b,e)},fail:function(a){F(a,e)},debug:d,url:n})},where_now:function(a,b){var b=a.callback||b,d=a.error||function(){},e=a.auth_key||W,f=ya(),g=a.uuid||Ba,h={auth:e};return b?V?("0"!=f&&(h.callback=f),Ca&&(h.instanceid=Fa),void G({callback:f,data:c(h),success:function(a){E(a,b,d)},fail:function(a){F(a,d)},url:[_,"v2","presence","sub_key",V,"uuid",l.encode(g)]})):wa("Missing Subscribe Key"):wa("Missing Callback")},state:function(a,b){var d,b=a.callback||b||function(a){},e=a.error||function(){},f=a.auth_key||W,g=ya(),h=a.state,i=a.uuid||Ba,j=a.channel,k=a.channel_group,m=c({auth:f});return V?i?j||k?("0"!=g&&(m.callback=g),"undefined"!=typeof j&&la[j]&&la[j].subscribed&&h&&(na[j]=h),"undefined"!=typeof k&&ma[k]&&ma[k].subscribed&&(h&&(na[k]=h),m["channel-group"]=k,j||(j=",")),m.state=JSON.stringify(h),Ca&&(m.instanceid=Fa),d=h?[_,"v2","presence","sub-key",V,"channel",j,"uuid",i,"data"]:[_,"v2","presence","sub-key",V,"channel",j,"uuid",l.encode(i)],void G({callback:g,data:c(m),success:function(a){E(a,b,e)},fail:function(a){F(a,e)},url:d})):wa("Missing Channel"):wa("Missing UUID"):wa("Missing Subscribe Key")},grant:function(a,b){var b=a.callback||b,d=a.error||function(){},e=a.channel||a.channels,f=a.channel_group,g=ya(),h=a.ttl,i=a.read?"1":"0",j=a.write?"1":"0",k=a.manage?"1":"0",m=a.auth_key||a.auth_keys;if(!b)return wa("Missing Callback");if(!V)return wa("Missing Subscribe Key");if(!U)return wa("Missing Publish Key");if(!X)return wa("Missing Secret Key");var n={w:j,r:i};a.manage&&(n.m=k),l.isArray(e)&&(e=e.join(",")),l.isArray(m)&&(m=m.join(",")),"undefined"!=typeof e&&null!=e&&e.length>0&&(n.channel=e),"undefined"!=typeof f&&null!=f&&f.length>0&&(n["channel-group"]=f),"0"!=g&&(n.callback=g),(h||0===h)&&(n.ttl=h),m&&(n.auth=m),n=c(n),m||delete n.auth,G({operation:"PNAccessManagerGrant",callback:g,data:n,success:function(a){E(a,b,d)},fail:function(a){F(a,d)},url:[_,"v1","auth","grant","sub-key",V]})},mobile_gw_provision:function(a){var b,c,d=a.callback||function(){},e=a.auth_key||W,f=a.error||function(){},g=ya(),h=a.channel,i=a.op,j=a.gw_type,k=a.device_id;return k?j?i?h?V?(c=[_,"v1/push/sub-key",V,"devices",k],b={uuid:Ba,auth:e,type:j},"add"==i?b.add=h:"remove"==i&&(b.remove=h),Ca&&(b.instanceid=Fa),void G({callback:g,data:b,success:function(a){E(a,d,f)},fail:function(a){F(a,f)},url:c})):wa("Missing Subscribe Key"):wa("Missing gw destination Channel (channel)"):wa("Missing GW Operation (op: add or remove)"):wa("Missing GW Type (gw_type: gcm or apns)"):wa("Missing Device ID (device_id)")},audit:function(a,b){var b=a.callback||b,d=a.error||function(){},e=a.channel,f=a.channel_group,g=a.auth_key,h=ya();if(!b)return wa("Missing Callback");if(!V)return wa("Missing Subscribe Key");if(!U)return wa("Missing Publish Key");if(!X)return wa("Missing Secret Key");var i={};"0"!=h&&(i.callback=h),"undefined"!=typeof e&&null!=e&&e.length>0&&(i.channel=e),"undefined"!=typeof f&&null!=f&&f.length>0&&(i["channel-group"]=f),g&&(i.auth=g),i=c(i),g||delete i.auth,G({operation:"PNAccessManagerAudit",callback:h,data:i,success:function(a){E(a,b,d)},fail:function(a){F(a,d)},url:[_,"v1","auth","audit","sub-key",V]})},revoke:function(a,b){a.read=!1,a.write=!1,Ka.grant(a,b)},set_uuid:function(a){Ba=a,ba()},get_uuid:function(){return Ba},isArray:function(a){return l.isArray(a)},get_subscribed_channels:function(){return e(la,!0)},presence_heartbeat:function(a){var b=a.callback||function(){},d=a.error||function(){},g=ya(),h={uuid:Ba,auth:W},i=JSON.stringify(na);i.length>2&&(h.state=JSON.stringify(na)),pa>0&&pa<320&&(h.heartbeat=pa),"0"!=g&&(h.callback=g);var j=l.encode(e(la,!0).join(",")),k=f(ma,!0).join(",");j||(j=","),k&&(h["channel-group"]=k),Ca&&(h.instanceid=Fa),G({callback:g,data:c(h),url:[_,"v2","presence","sub-key",V,"channel",j,"heartbeat"],success:function(a){E(a,b,d)},fail:function(a){F(a,d)}})},stop_timers:function(){clearTimeout(N),clearTimeout(O),clearTimeout(oa)},shutdown:function(){Ka.stop_timers(),Ga&&Ga()},xdr:ua,ready:g,db:za,uuid:l.generateUUID,map:l.map,each:l.each,"each-channel":D,grep:l.grep,offline:function(){K(1,{message:"Offline. Please check your network settings."})},supplant:l.supplant,now:l.rnow,unique:d,updater:l.updater};return Ba||(Ba=Ka.uuid()),Fa||(Fa=Ka.uuid()),za.set(V+"uuid",Ba),N=l.timeout(I,u),O=l.timeout(J,R),oa=l.timeout(A,(qa-3)*u),M(),Ka}var j=c(4),k=c(5),l=c(6),m=1,n=!1,o=[],p="-pnpres",q=10,r=15e3,s=310,t=60,u=1e3,v=5,w=30,x=j.version,y=function(){var a=20,b=Math.floor(Math.random()*a);return function(c,d){return c.indexOf("pubsub.")>0&&c.replace("pubsub","ps"+(d?l.generateUUID().split("-")[0]:++b<a?b:b=1))||c}}();a.exports={PN_API:i,unique:d,PNmessage:h,DEF_TIMEOUT:r,timeout:l.timeout,build_url:l.buildURL,each:l.each,uuid:l.generateUUID,URLBIT:k.URLBIT,grep:l.grep,supplant:l.supplant,now:l.rnow,updater:l.updater,map:l.map}},function(a,b){a.exports={name:"pubnub",preferGlobal:!1,version:"3.16.3",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",lodash:"^4.1.0"},noAnalyze:!1,devDependencies:{chai:"^3.5.0",eslint:"2.4.0","eslint-config-airbnb":"^6.0.2","eslint-plugin-flowtype":"^2.1.0","eslint-plugin-mocha":"^2.0.0","eslint-plugin-react":"^4.1.0","flow-bin":"^0.22.0",grunt:"^0.4.5","grunt-contrib-clean":"^1.0.0","grunt-contrib-copy":"^0.8.2","grunt-contrib-uglify":"^0.11.1","grunt-env":"^0.4.4","grunt-eslint":"^18.0.0","grunt-flow":"^1.0.3","grunt-karma":"^0.12.1","grunt-mocha-istanbul":"^3.0.1","grunt-text-replace":"^0.4.0","grunt-webpack":"^1.0.11","imports-loader":"^0.6.5",isparta:"^4.0.0","json-loader":"^0.5.4",karma:"^0.13.21","karma-chai":"^0.1.0","karma-mocha":"^0.2.1","karma-phantomjs-launcher":"^1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.0",mocha:"^2.4.5",nock:"^1.1.0","node-uuid":"^1.4.7",nodeunit:"^0.9.0","phantomjs-prebuilt":"^2.1.4",proxyquire:"^1.7.4",sinon:"^1.17.2","uglify-js":"^2.6.1",underscore:"^1.7.0",webpack:"^1.12.13","webpack-dev-server":"^1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"},files:["core","node.js","modern","CHANGELOG","FUTURE.md","LICENSE","README.md"]}},function(a,b){a.exports={PARAMSBIT:"&",URLBIT:"/"}},function(a,b,c){function d(){return+new Date}function e(a){return!!a&&"string"!=typeof a&&(Array.isArray&&Array.isArray(a)||"number"==typeof a.length)}function f(a,b){if(a&&b)if(e(a))for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(var c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function g(a){return encodeURIComponent(a)}function h(a,b){var c=a.join(p.URLBIT),d=[];return b?(f(b,function(a,b){var c="object"==typeof b?JSON.stringify(b):b;"undefined"!=typeof b&&null!==b&&g(c).length>0&&d.push(a+"="+g(c))}),c+="?"+d.join(p.PARAMSBIT)):c}function i(a,b){var c,e=0,f=function(){e+b>d()?(clearTimeout(c),c=setTimeout(f,b)):(e=d(),a())};return f}function j(a,b){var c=[];return f(a||[],function(a){b(a)&&c.push(a)}),c}function k(a,b){return a.replace(q,function(a,c){return b[c]||a})}function l(a,b){if("undefined"!=typeof setTimeout)return setTimeout(a,b)}function m(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a&&a(b),b}function n(a,b){var c=[];return f(a||[],function(a,d){c.push(b(a,d))}),c}function o(a){return encodeURIComponent(a).replace(/[!'()*~]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()})}var p=c(5),q=/{([\w\-]+)}/g;a.exports={buildURL:h,encode:g,each:f,updater:i,rnow:d,isArray:e,map:n,pamEncode:o,generateUUID:m,timeout:l,supplant:k,grep:j}}])});